<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=1024" name="viewport">


    <title>HID устройство для вращения камеры / Хабрахабр</title>

    <meta name="yandex-verification" content="67d46b975fa41645"> <!-- яндекс вебмастер - верификация -->

    <meta name="description" content="
Это продолжение моей статьи об устройстве для вращения Веб-камеры (предыдущую статью можно найти тут).

В этой части я расскажу о создании программной части: прошивки для микроконтроллера...">
    <meta name="keywords" content="микроконтроллер ATtiny85, драйвер двигателей l293d, V-USB, Skype API">

      <meta property="fb:app_id" content="444736788986613"> 
<meta property="og:type" content="article"> 
<meta property="og:url" content="http://habrahabr.ru/post/215841/"> 
<meta property="og:title" content="Часть 2. HID устройство для вращения камеры">
	<meta property="og:image" content="http://habrastorage.org/getpro/habr/post_images/0c9/ca0/8d1/0c9ca08d1af7d3c37f5e0f58e59c404b.jpg">
	<link rel="image_src" href="http://habrastorage.org/getpro/habr/post_images/0c9/ca0/8d1/0c9ca08d1af7d3c37f5e0f58e59c404b.jpg"><meta property="og:image" content="http://habrastorage.org/getpro/habr/post_images/ede/8b5/18e/ede8b518eae4bfad7699e60fec30d3b8.jpg">
	<link rel="image_src" href="http://habrastorage.org/getpro/habr/post_images/ede/8b5/18e/ede8b518eae4bfad7699e60fec30d3b8.jpg">
	
<meta property="og:description" content="Это продолжение моей статьи об устройстве для вращения Веб-камеры (предыдущую статью можно найти тут).  В этой части я расскажу о создании программной части:...">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@habrahabr">
  <meta property="al:ios:url" content="habrahabr://post/215841">
<meta property="al:ios:app_store_id" content="778613673">
<meta property="al:ios:app_name" content="Habrahabr">
<meta property="al:android:url" content="habrahabr://post/215841">
<meta property="al:android:app_name" content="Habrahabr">
<meta property="al:android:package" content="ru.habrahabr">
<meta property="al:windows_phone:url" content="habrahabr://post/215841">
<meta property="al:windows_phone:app_name" content="Habrahabr">
<meta property="al:windows_phone:app_id" content="460a6bd6-8955-470f-935e-9ea1726a6060">
  <link rel="canonical" href="http://habrahabr.ru/post/215841/">
  <link rel="alternate" media="only screen and (max-width: 640px)" href="http://m.habrahabr.ru/post/215841/">



    <script id="an.yandex.ru/resource/context_static_r975.js" src="http://an.yandex.ru/resource/context_static_r975.js"></script><script async="" src="//connect.facebook.net/en_US/fbevents.js"></script><script type="text/javascript" async="" src="http://mc.yandex.ru/metrika/watch.js"></script><script type="text/javascript" src="//an.yandex.ru/system/context.js" async=""></script><script async="" src="//www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="//habracdn.net/habr/javascripts/1444315133/assets/global_main.js"></script>
      <link href="//habracdn.net/habr/styles/1444315133/assets/post_common_css.css" rel="stylesheet" media="all">
  <link href="//habracdn.net/habr/styles/1444315133/users/all.css" rel="stylesheet" media="all">

    <link href="//habracdn.net/habr/styles/1444315133/assets/global_main.css" rel="stylesheet" media="all">
    <link href="//habracdn.net/habr/styles/1444315133/printer.css" rel="stylesheet" media="print">

    
    




      <script type="text/javascript" src="//habracdn.net/habr/javascripts/1444315133/assets/post_common_js.js"></script>
  <script type="text/javascript" src="//habracdn.net/habr/javascripts/1444315133/users/all.js"></script>


      
      <script>
        var N = 5;
        var ar_duo1 = Math.floor(Math.random()*N+1);
      </script>
      <script type="text/javascript" src="//habracdn.net/habr/javascripts/1444315133/adriver.core.2.js"></script>

    <link title="Хабрахабр / Комментарии к публикации «Часть 2. HID устройство для вращения камеры»" type="application/rss+xml" rel="alternate" href="http://habrahabr.ru/rss/post/215841/">

    <script src="//habracdn.net/habr/javascripts/1444315133/_parts/advertising.js"></script>

<script type="text/javascript">

  if (typeof adbl == 'undefined')
  {
    var adbl = 'yes';
  }

  var user_type = 'habrauser';

  var page_type = "publish_ugc";

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-726094-1',  'auto', { 'userId': '60eb4c67d58f549c538bdc44c84b484b' });
  ga('create', 'UA-726094-24', 'auto', { 'userId': '60eb4c67d58f549c538bdc44c84b484b', 'name': 'HGM' });

  ga('require', 'displayfeatures');
  ga('set', 'dimension1', user_type); // user type - guest/readonly/habrauser


  ga('set', 'dimension4', adbl);

  ga('set', 'dimension5', page_type);


  if(typeof removeUtms === 'undefined') {
    removeUtms = function(){};
  }

  ga('HGM.set', 'dimension1', user_type);
  ga('HGM.set', 'dimension2', "habrahabr");
  ga('HGM.send', 'pageview');

  ga('send', 'pageview', { 'hitCallback': removeUtms });


</script>


    <meta content="Хабрахабр" name="apple-mobile-web-app-title">
<link href="/images/apple-touch-icon_142x142.png" rel="apple-touch-icon" type="image/png">
  <style type="text/css"></style><script charset="utf-8" src="//mc.yandex.ru/metrika/watch.js"></script><style type="text/css">.yap-R-149298-5,.yap-R-149298-5 yatag{display:block!important;box-sizing:content-box!important}.yap-R-149298-5,.yap-R-149298-5 a,.yap-R-149298-5 em,.yap-R-149298-5 img,.yap-R-149298-5 table,.yap-R-149298-5 tbody,.yap-R-149298-5 tr,.yap-R-149298-5 td{font-size:inherit!important;background:none!important;border:none!important;border-radius:0!important;border-spacing:0!important;border-collapse:collapse!important;box-sizing:content-box!important;clear:none!important;float:none!important;font-variant:normal!important;font-weight:400!important;height:auto!important;letter-spacing:normal!important;line-height:normal!important;margin:0!important;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;outline:none!important;padding:0!important;position:static!important;text-align:left!important;text-decoration:none!important;text-indent:0!important;text-transform:none!important;vertical-align:baseline!important;visibility:visible!important;word-spacing:normal!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 table{display:table!important;empty-cells:hide!important;font-size:100%!important;table-layout:fixed!important}.yap-R-149298-5 td{display:table-cell!important;font-size:100%!important;vertical-align:middle!important}#yap-R-149298-5 .yap-layout_block_728x90 .yap-title-block{white-space:normal!important}#yap-R-149298-5 .yap-layout_block_vertical .yap-title-block{display:block!important}#yap-R-149298-5 .yap-layout_block_poster .yap-title-block,#yap-R-149298-5 .yap-layout_block_mailru .yap-title-block{display:inline!important}#yap-R-149298-5 .yap-type-vertical .yap-logo{position:static!important}#yap-R-149298-5 .yap-layout_block_row .yap-logo{top:0!important}.yap-R-149298-5{overflow:visible!important;white-space:normal!important;width:100%!important;font-size:100%!important;color:#333333!important;font-family:inherit!important;position:relative!important;z-index:1!important}.yap-R-149298-5 .yap-layout{overflow:hidden!important;position:relative!important;z-index:1!important}.yap-R-149298-5 .yap-layout_block_0x50{min-width:320px!important;font-size:13px!important}.yap-R-149298-5 .yap-layout__items{width:100%!important;border-collapse:separate!important}.yap-R-149298-5 .yap-layout__outer{position:relative!important;z-index:1!important;zoom:1!important}.yap-R-149298-5 .yap-layout__inner{overflow:hidden!important;width:auto!important;padding:.7em!important}.yap-R-149298-5 .yap-layout_type_medium .yap-layout__inner{padding:.6em .1em .6em .6em!important}.yap-R-149298-5 .yap-layout_type_medium .yap-layout__warning{margin-right:.4em!important}.yap-R-149298-5 .yap-layout__body{margin-top:0.23em!important}.yap-R-149298-5 .yap-layout__sitelinks,.yap-R-149298-5 .yap-layout__schedule,.yap-R-149298-5 .yap-layout__warning{margin-top:.23em!important}.yap-R-149298-5 .yap-layout__adtune{display:none!important;position:absolute!important;right:1px!important;top:1px!important;cursor:pointer!important;z-index:10!important}.yap-R-149298-5 .yap-layout__item:hover .yap-layout__adtune{display:block!important}.yap-R-149298-5 .yap-layout__adtune-message{display:none!important}.yap-R-149298-5 .yap-layout__item_abused .yap-layout__inner,.yap-R-149298-5 .yap-layout__item_abused .yap-layout__inner *{visibility:hidden!important}.yap-R-149298-5 .yap-layout__item_abused .yap-layout__adtune-message{display:block!important}.yap-R-149298-5 .yap-layout__picture-rating{margin-top:.23em!important}.yap-R-149298-5 .yap-layout__app{margin-top:.4em!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__extra{margin-top:-1px!important}.yap-R-149298-5 .yap-layout__wrapper{background:transparent!important;border-width:0!important;border-color:#FBE5C0!important;border-style:solid!important;border-radius:0!important;position:relative!important;z-index:1!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_horizontal .yap-layout__wrapper{margin-right:-10px!important}.yap-R-149298-5 .yap-layout_block_grid .yap-layout__wrapper{margin-right:-10px!important}.yap-R-149298-5 .yap-layout_block_fixed-vertical .yap-layout__wrapper{height:NaNpx!important}.yap-R-149298-5 .yap-layout_block_fixed-horizontal .yap-layout__wrapper{margin-left:17px!important;width:NaNpx!important;height:NaNpx!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__wrapper{padding-left:17px!important;border:none!important;background:transparent!important}.yap-R-149298-5 .yap-layout__logo{display:inline-block!important;padding-left:.7em!important;box-sizing:border-box!important;background:transparent!important}.yap-R-149298-5 .yap-layout_type_medium .yap-layout__logo{padding-left:.6em!important}.yap-R-149298-5 .yap-layout_block_fixed-vertical .yap-layout__logo{padding-left:5px!important}.yap-R-149298-5 .yap-layout_block_fixed-horizontal .yap-layout__logo{overflow:hidden!important;position:absolute!important;left:0!important;top:0!important;width:17px!important;height:100%!important;padding:0!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__logo{z-index:1!important;position:relative!important;float:left!important;margin-right:.5em!important;padding-left:.4em!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__logo{overflow:hidden!important;position:absolute!important;left:0!important;top:0!important;width:17px!important;height:100%!important;padding:0!important;margin:0!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__item_abused .yap-layout__logo,.yap-R-149298-5 .yap-layout_block_compact .yap-layout__item_abused .yap-layout__logo *{visibility:visible!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__logo{float:none!important;display:inline-block!important;vertical-align:!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__logo{padding:.4em .8em!important;font-size:120%!important;color:#666!important;background:none!important}.yap-R-149298-5 .yap-layout__item{vertical-align:top!important;border-width:1px!important;border-color:#FBE5C0!important;border-style:solid!important;border-radius:0!important;background:transparent!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout__item_abused{background:#fff!important}.yap-R-149298-5 .yap-layout_block_vertical .yap-layout__item{border-bottom-width:1px!important}.yap-R-149298-5 .yap-layout_block_vertical tr:last-child .yap-layout__item{border-bottom-width:!important}.yap-R-149298-5 .yap-layout_block_horizontal .yap-layout__item{width:50.00%!important;border-right-width:1px!important}.yap-R-149298-5 .yap-layout_block_horizontal .yap-layout__item:last-child{border-right-width:!important}.yap-R-149298-5 .yap-layout_block_grid .yap-layout__item{width:100.00%!important}.yap-R-149298-5 .yap-layout_block_grid .yap-layout__item_nth_1,.yap-R-149298-5 .yap-layout_block_grid .yap-layout__item_nth_2{border-bottom-width:!important}.yap-R-149298-5 .yap-layout_block_grid .yap-layout__item_nth_1,.yap-R-149298-5 .yap-layout_block_grid .yap-layout__item_nth_3{border-right-width:!important}.yap-R-149298-5 .yap-layout_block_fixed-vertical .yap-layout__item{vertical-align:middle!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__item{overflow:hidden!important;padding:.1539em 15px .1539em .1539em!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item{tap-highlight-color:rgba(0,0,0,0)!important;outline:none!important;cursor:pointer!important;-webkit-tap-highlight-color:rgba(0,0,0,0)!important;-moz-tap-highlight-color:rgba(0,0,0,0)!important;-ms-tap-highlight-color:rgba(0,0,0,0)!important;-o-tap-highlight-color:rgba(0,0,0,0)!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_picture_false{background-color:#fff!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_abused{background:#fff!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__item{height:48px!important;border-width:0!important;border-color:#FBE5C0!important;border-style:solid!important;border-radius:0!important;background:transparent!important;padding:0 15px 0 0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__item.yap-layout__item_picture_false{padding-left:5px!important}.yap-R-149298-5 .yap-layout_type_wide .yap-layout__picture,.yap-R-149298-5 .yap-layout_type_medium .yap-layout__picture,.yap-R-149298-5 .yap-layout_type_compatible .yap-layout__picture{float:left!important;padding-right:.7em!important}.yap-R-149298-5 .yap-layout_type_medium .yap-layout__picture{padding-right:.6em!important}.yap-R-149298-5 .yap-layout_type_narrow .yap-layout__picture{padding-bottom:.7em!important;margin:0 auto!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_wide .yap-layout__picture,.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_medium .yap-layout__picture,.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_compatible .yap-layout__picture,.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_728x90.yap-layout_block_msn .yap-layout__picture{padding-right:5px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_adaptive .yap-layout__picture{padding-right:6px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_narrow .yap-layout__picture{padding-bottom:5px!important;position:relative!important;left:-2px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_adaptive.yap-layout_type_narrow .yap-layout__picture{padding:0 0 7px!important;left:0!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_728x90 .yap-layout__picture{padding:0!important}.yap-R-149298-5 .yap-layout_type_wide.yap-layout_block_728x90 .yap-layout__item_nth_1 .yap-layout__picture{overflow:hidden!important;border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_320x50 .yap-layout__picture{padding:0!important;overflow:hidden!important;border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_type_wide.yap-layout_block_msn .yap-layout__item_nth_1 .yap-layout__picture{overflow:visible!important;border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_type_narrow.yap-layout_block_single_vertical .yap-layout__picture{padding-bottom:12px!important;margin:0!important;text-align:center!important;width:auto!important;left:0!important}.yap-R-149298-5 .yap-layout_type_narrow.yap-layout_block_single_vertical.yap-layout_block_single_small .yap-layout__picture{padding-bottom:8px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__picture{float:none!important;display:block!important;padding:0!important;margin-bottom:0!important;margin-right:0!important;background-position:center center!important;background-repeat:no-repeat!important;background-size:contain!important;box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)!important;border:none!important;position:absolute!important;z-index:2!important;left:50%!important;top:50%!important;-webkit-background-size:contain!important;-moz-background-size:contain!important;-ms-background-size:contain!important;-o-background-size:contain!important;-webkit-box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)!important;-moz-box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)!important;-ms-box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)!important;-o-box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__picture_plain{border:none!important;box-shadow:none!important;-webkit-box-shadow:none!important;-moz-box-shadow:none!important;-ms-box-shadow:none!important;-o-box-shadow:none!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__picture{padding-right:.6em!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__picture{overflow:hidden!important;float:left!important;margin:-2px 5px -2px 0!important;border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_type_wide .yap-layout__content,.yap-R-149298-5 .yap-layout_type_medium .yap-layout__content{overflow:hidden!important}.yap-R-149298-5 .yap-layout_type_wide .yap-layout__item_age .yap-layout__content,.yap-R-149298-5 .yap-layout_type_medium .yap-layout__item_age .yap-layout__content{padding-bottom:1px!important}.yap-R-149298-5 .yap-layout_block_728x90 .yap-layout__content{padding:4px 1px 4px 5px!important}.yap-R-149298-5 .yap-layout_block_adaptive .yap-layout__content{zoom:1!important}.yap-R-149298-5 .yap-layout_block_728x90.yap-layout_block_msn .yap-layout__content{padding:0!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__content{padding:2px 1px 1px 5px!important}#yap-R-149298-5 .yap-layout_block_single .yap-layout__content{font-size:15px!important}#yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_medium .yap-layout__content{font-size:14px!important}#yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_small .yap-layout__content{font-size:13px!important}.yap-R-149298-5 .yap-layout_type_narrow.yap-layout_block_single_vertical .yap-layout__content{text-align:center!important}.yap-R-149298-5 .yap-layout_type_wide.yap-layout_block_single728x90 .yap-layout__content{padding:4px 9px!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__content{overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__content{display:inline!important;margin-left:.6em!important;text-overflow:ellipsis!important;-webkit-text-overflow:ellipsis!important;-moz-text-overflow:ellipsis!important;-ms-text-overflow:ellipsis!important;-o-text-overflow:ellipsis!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__content{position:relative!important;z-index:1!important;zoom:1!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__content{padding:2px 2px 2px 0!important}.yap-R-149298-5 .yap-layout__contacts{margin-top:.23em!important}.yap-R-149298-5 .yap-layout_hide_contacts.yap-layout_hide_domain .yap-layout__contacts{display:none!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__contacts{margin-top:0!important}.yap-R-149298-5 .yap-layout_block_single .yap-layout__contacts{margin-top:5px!important}.yap-R-149298-5 .yap-layout_block_single_vertical .yap-layout__contacts{margin-top:7px!important}.yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_small .yap-layout__contacts{margin-top:4px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__contacts{margin-top:.63em!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__contacts{padding-top:.6em!important;margin-top:0!important;overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_mailru-vertical .yap-layout__contacts{clear:both!important;zoom:1!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__contacts{margin-top:0!important}.yap-R-149298-5 .yap-layout__action{margin-left:.4em!important;text-decoration:none!important;color:#333333!important}.yap-R-149298-5 .yap-layout__action:hover{color:#666666!important}.yap-R-149298-5 .yap-layout__action-price{display:inline!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__action{margin-left:0!important}.yap-R-149298-5 .yap-layout__rating{position:relative!important;top:.1em!important;display:inline-block!important;vertical-align:top!important;margin-left:.5em!important;font-size:.8em!important}.yap-R-149298-5 .yap-layout_hide-title-rating .yap-layout__rating{display:none!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__rating{margin-left:1em!important}.yap-R-149298-5 .yap-layout__age{vertical-align:top!important;display:inline-block!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__age{position:absolute!important;right:0!important;top:0!important;margin:0!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__age{display:inline!important;position:static!important;margin-left:.6em!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-layout__age{top:2px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__age{vertical-align:baseline!important}.yap-R-149298-5 .yap-layout__address{zoom:1!important;overflow:hidden!important;width:100%!important;margin-top:.23em!important}.yap-R-149298-5 .yap-layout_hide_address .yap-layout__address{display:none!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__address{width:auto!important}.yap-R-149298-5 .yap-layout_block_vertical .yap-layout__items{border-spacing:0 5px!important;margin-top:-5px!important;margin-bottom:-5px!important}.yap-R-149298-5 .yap-layout_block_horizontal .yap-layout__items{border-spacing:5px 0!important;margin-left:-5px!important}.yap-R-149298-5 .yap-layout_block_grid .yap-layout__items{border-spacing:5px 5px!important;margin:-5px!important}.yap-R-149298-5{width:!important;height:!important}.yap-R-149298-5 .yap-layout_block_fixed{font-size:13px!important;width:px!important;height:px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-medium{font-size:11px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-small{font-size:10px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_invisible,.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_invisible *{visibility:hidden!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-layout__items{height:100%!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-layout__inner{padding:5px 1px 5px 5px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_728x90 .yap-layout__inner{padding:0!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_728x90.yap-layout_block_msn .yap-layout__inner{padding:4px 1px 4px 4px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_adaptive .yap-layout__inner{padding:5px 6px!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-layout__warning{margin-right:4px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-small .yap-layout__warning{margin-top:0!important}.yap-R-149298-5 .yap-layout_hide_sitelinks .yap-layout__sitelinks,.yap-R-149298-5 .yap-layout_hide_schedule .yap-layout__schedule{display:none!important}.yap-R-149298-5 .yap-layout_block_fixed-horizontal.yap-layout_text-inline .yap-layout__title,.yap-R-149298-5 .yap-layout_block_fixed-horizontal.yap-layout_text-inline .yap-layout__body{display:inline!important}.yap-R-149298-5 .yap-layout_block_fixed-horizontal.yap-layout_text-inline .yap-layout__title{margin-right:5px!important}.yap-R-149298-5 .yap-layout_block_fixed-horizontal.yap-layout_text-inline .yap-layout__body{margin-top:0!important}.yap-R-149298-5 .yap-layout_block_320x100 .yap-layout__inner{padding:4px 1px 4px 4px!important}.yap-R-149298-5 .yap-layout_block_160x600 .yap-layout__inner{padding-right:0!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__inner{padding:0!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__body,.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__sitelinks,.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__schedule,.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__warning{margin-top:0!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-layout__app{margin-top:.23em!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-layout__app{margin-top:0!important;padding-bottom:.2em!important}.yap-R-149298-5 .yap-layout_hide_app .yap-layout__app{display:none!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_narrow .yap-layout__app{padding-right:4px!important}.yap-R-149298-5 .yap-layout_block_single_vertical .yap-picture-block__link,.yap-R-149298-5 .yap-layout_block_single_vertical .yap-picture-block__img{display:inline-block!important}.yap-R-149298-5 .yap-layout_type_narrow.yap-layout_block_single_vertical .yap-layout__inner{padding:10px 25px!important}.yap-R-149298-5 .yap-layout_type_narrow.yap-layout_block_single240x400 .yap-layout__inner{padding:10px!important}.yap-R-149298-5 .yap-layout_block_single .yap-layout__warning,.yap-R-149298-5 .yap-layout_block_single .yap-layout__body{margin-top:5px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_single.yap-layout_block_horizontal .yap-layout__item_app .yap-layout__body{margin-top:3px!important}.yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_small .yap-layout__warning,.yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_small .yap-layout__body{margin-top:4px!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_single .yap-layout__warning{margin-right:0!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_single.yap-layout_block_vertical .yap-layout__app{margin:10px 0 0!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_single.yap-layout_block_horizontal .yap-layout__app{margin:2px 0 0!important}.yap-R-149298-5 .yap-layout_block_msn{font-size:11px!important}.yap-R-149298-5 .yap-layout_block_msn.yap-layout_size_1{font-size:10px!important}.yap-R-149298-5 .yap-layout_block_msn.yap-layout_size_2{font-size:9px!important}.yap-R-149298-5 .yap-layout_block_msn .yap-layout__warning{font-size:12px!important}.yap-R-149298-5 .yap-layout_block_compact{overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__inner{padding:0!important;position:relative!important;z-index:1!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__inner,.yap-R-149298-5 .yap-layout_block_compact .yap-layout__title{overflow:hidden!important;text-overflow:ellipsis!important;-webkit-text-overflow:ellipsis!important;-moz-text-overflow:ellipsis!important;-ms-text-overflow:ellipsis!important;-o-text-overflow:ellipsis!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__title{white-space:nowrap!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__item_age_true .yap-layout__title{padding-right:3em!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__title-domain{display:inline!important;padding-left:.4em!important}.yap-R-149298-5 .yap-layout_block_compact.yap-layout_hide-title-domain .yap-layout__title-domain{display:none!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__body{margin-top:0!important;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;-webkit-text-overflow:ellipsis!important;-moz-text-overflow:ellipsis!important;-ms-text-overflow:ellipsis!important;-o-text-overflow:ellipsis!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__adtune{position:absolute!important;right:2px!important;top:4px!important;z-index:1!important}.yap-R-149298-5 .yap-layout_block_row{white-space:nowrap!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__title,.yap-R-149298-5 .yap-layout_block_row .yap-layout__body{display:inline!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__item_age_true .yap-layout__title{padding-right:0!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__title-domain{display:none!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__body,.yap-R-149298-5 .yap-layout_block_row .yap-layout__body-domain{margin-left:.4em!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__adtune{right:1px!important;top:50%!important;margin-top:-7px!important}.yap-R-149298-5 .yap-layout_block_row .yap-layout__inner{padding:!important}.yap-R-149298-5 .yap-layout_block_poster{max-width:300px!important;min-width:200px!important;font-size:13px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__outer,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__inner{overflow:hidden!important;position:relative!important;z-index:1!important;zoom:1!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__inner{padding:0!important;margin:7px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__title,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__slider,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__warning{padding:9px!important;background:#fff!important;position:relative!important;z-index:3!important;margin:0!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__title{padding-right:25px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__body{margin:0!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__arrow{position:absolute!important;right:9px!important;bottom:10px!important;transition:opacity 300ms ease-in-out,bottom 300ms ease-in-out!important;opacity:.6!important;-webkit-transition:opacity 300ms ease-in-out,bottom 300ms ease-in-out!important;-moz-transition:opacity 300ms ease-in-out,bottom 300ms ease-in-out!important;-ms-transition:opacity 300ms ease-in-out,bottom 300ms ease-in-out!important;-o-transition:opacity 300ms ease-in-out,bottom 300ms ease-in-out!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_sticky-arrow_true .yap-layout__arrow{bottom:3px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__arrow path,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__arrow path:hover{fill:#333333!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__adtune{z-index:4!important;display:block!important;position:absolute!important;right:7px!important;top:7px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__sitelinks{margin-top:.55em!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__schedule,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__app{margin-top:.63em!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__title-domain,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__title-rating{margin-top:.23em!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__title-domain{font-size:15px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__bg{position:absolute!important;z-index:1!important;width:200%!important;height:200%!important;left:-50%!important;top:-30%!important;opacity:.3!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__bg svg{width:100%!important;height:100%!important;position:absolute!important;left:0!important;top:0!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__bg_firefox{background-repeat:no-repeat!important;background-size:contain!important;background-position:center center!important;filter:blur(4px)!important;-webkit-background-size:contain!important;-moz-background-size:contain!important;-ms-background-size:contain!important;-o-background-size:contain!important;-webkit-filter:blur(4px)!important;-moz-filter:blur(4px)!important;-ms-filter:blur(4px)!important;-o-filter:blur(4px)!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__bg_old-ie{filter:alpha(opacity=30)!important;text-align:center!important;height:!important;-webkit-filter:alpha(opacity=30)!important;-moz-filter:alpha(opacity=30)!important;-ms-filter:alpha(opacity=30)!important;-o-filter:alpha(opacity=30)!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__bg_old-ie img{display:inline-block!important;height:100%!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__slider{z-index:2!important;box-shadow:0 -1px #fff!important;box-sizing:border-box!important;padding-top:0!important;-webkit-box-shadow:0 -1px #fff!important;-moz-box-shadow:0 -1px #fff!important;-ms-box-shadow:0 -1px #fff!important;-o-box-shadow:0 -1px #fff!important}.yap-R-149298-5 .yap-layout_block_poster.yap-layout_transition_true .yap-layout__slider{transition:transform 300ms ease-in-out,opacity 300ms ease-in-out!important;transform:translateY(-100%)!important;transform-origin:left top!important;opacity:0!important;-webkit-transition:-webkit-transform 300ms ease-in-out,opacity 300ms ease-in-out!important;-moz-transition:-moz-transform 300ms ease-in-out,opacity 300ms ease-in-out!important;-ms-transition:-ms-transform 300ms ease-in-out,opacity 300ms ease-in-out!important;-o-transition:-o-transform 300ms ease-in-out,opacity 300ms ease-in-out!important;-webkit-transform:translateY(-100%)!important;-moz-transform:translateY(-100%)!important;-ms-transform:translateY(-100%)!important;-o-transform:translateY(-100%)!important;-webkit-transform-origin:left top!important;-moz-transform-origin:left top!important;-ms-transform-origin:left top!important;-o-transform-origin:left top!important}.yap-R-149298-5 .yap-layout_block_poster.yap-layout_transition_true .yap-layout__item_picture_false .yap-layout__slider,.yap-R-149298-5 .yap-layout_block_poster.yap-layout_transition_true.yap-layout_touch_false .yap-layout__item:hover .yap-layout__slider,.yap-R-149298-5 .yap-layout_block_poster.yap-layout_transition_true .yap-layout__item_hover .yap-layout__slider{transform:none!important;opacity:1!important;-webkit-transform:none!important;-moz-transform:none!important;-ms-transform:none!important;-o-transform:none!important}.yap-R-149298-5 .yap-layout_block_poster.yap-layout_touch_false .yap-layout__item:hover .yap-layout__arrow,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_hover .yap-layout__arrow{bottom:-30px!important;opacity:0!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_abused .yap-layout__bg{display:none!important}.yap-R-149298-5 .yap-layout_block_poster-horizontal{max-width:600px!important;min-width:400px!important}.yap-R-149298-5 .yap-layout_block_poster-horizontal .yap-layout__outer,.yap-R-149298-5 .yap-layout_block_poster-horizontal .yap-layout__slider-inner,.yap-R-149298-5 .yap-layout_block_poster-horizontal .yap-layout__title{box-sizing:border-box!important}.yap-R-149298-5 .yap-vk-main{display:block!important;font-family:Tahoma,Arial,Verdana,Lucida Sans,sans-serif!important;font-style:normal!important;font-weight:400!important;width:118px!important;padding:0!important;margin:0!important}.yap-R-149298-5 .yap-vk-main yatag{display:block!important}.yap-R-149298-5 .yap-vk-main img{border:0!important;display:inline-block!important}.yap-R-149298-5 .yap-vk-logo,.yap-R-149298-5 .yap-vk-logo *{color:#777!important;font-size:.91em!important;line-height:11px!important;font-weight:400!important;font-style:normal!important}.yap-R-149298-5 .yap-vk-logo{padding:3px 0 4px!important;text-align:center!important}.yap-R-149298-5 .yap-vk-main a.yap-vk-item,.yap-R-149298-5 .yap-vk-main a.yap-vk-item:hover,.yap-R-149298-5 .yap-vk-main a.yap-vk-item:visited{position:relative!important;display:block!important;padding:8px 3px 11px!important;text-decoration:none!important;color:#000!important;text-align:center!important;border-bottom:1px solid #DCE3E9!important}.yap-R-149298-5 .yap-vk-main a.yap-vk-item.yap-vk-item-1{border-top:1px solid #DCE3E9!important}.yap-R-149298-5 .yap-vk-title{color:#333333!important;font-weight:700!important;word-wrap:break-word!important}.yap-R-149298-5 .yap-vk-domain{color:#777!important;font-size:.91em!important;padding-top:3px!important;word-wrap:break-word!important}.yap-R-149298-5 .yap-vk-image{padding-top:9px!important}.yap-R-149298-5 .yap-vk-body{padding-top:10px!important;word-wrap:break-word!important}.yap-R-149298-5 .yap-vk-warning,.yap-R-149298-5 .yap-vk-age{color:#777!important;font-size:.82em!important;line-height:130%!important;padding-top:10px!important}.yap-R-149298-5 .yap-vk__app{margin-top:9px!important}.yap-R-149298-5 .yap-layout_block_mailru{font-size:10px!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__inner{padding:.4em .8em 1.2em!important;overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__title{margin-bottom:.5em!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__body{margin-top:0!important;overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__warning{padding-top:.6em!important;margin-top:0!important;overflow:hidden!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__warning{clear:both!important;zoom:1!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__adtune{right:3px!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__app{display:table-cell!important;margin:0!important;padding-top:.4em!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-body-text,.yap-R-149298-5 .yap-layout_block_mailru .yap-layout__app{font-size:120%!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-domain{font-size:110%!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-warning{border-radius:0!important;font-size:100%!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-domain:hover{color:#333333!important}.yap-R-149298-5 .yap-logo-block{position:relative!important;z-index:1!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-logo-block{height:16px!important}.yap-R-149298-5 .yap-logo-block__text{font-family:Arial,sans-serif!important;font-size:87%!important;padding-right:4px!important;line-height:1.4!important;font-weight:400!important;color:#000!important;text-decoration:none!important}.yap-R-149298-5 .yap-logo-block__text em{font-weight:400!important;font-style:normal!important;vertical-align:baseline!important}.yap-R-149298-5 .yap-logo-block__arrow{position:absolute!important;z-index:1!important;right:-9px!important;top:0!important;width:9px!important;height:100%!important;background-image:none!important;background-position:center right!important;background-repeat:no-repeat!important;margin-top:!important}.yap-R-149298-5 .yap-logo-fallback{display:none!important}.yap-R-149298-5 .yap-logo-block.yap-logo-block_type_vertical{display:block!important;position:absolute!important;z-index:1!important;left:0!important;bottom:6px!important;width:0!important;height:0!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-logo-block{bottom:0!important}.yap-R-149298-5 .yap-logo-block_type_vertical .yap-logo-block__text{display:inline-block!important;transform:rotate(270deg)!important;transform-origin:left top!important;font-size:10px!important;line-height:17px!important;padding:0!important;-webkit-transform:rotate(270deg)!important;-moz-transform:rotate(270deg)!important;-ms-transform:rotate(270deg)!important;-o-transform:rotate(270deg)!important;-webkit-transform-origin:left top!important;-moz-transform-origin:left top!important;-ms-transform-origin:left top!important;-o-transform-origin:left top!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-logo-block_type_vertical .yap-logo-block__text{width:50px!important;text-align:center!important}.yap-R-149298-5 .yap-logo-block_type_vertical .yap-logo-block__arrow{display:none!important}.yap-R-149298-5 .yap-logo-fallback{display:block!important;width:100%!important;height:100%!important;position:absolute!important;z-index:1!important;bottom:6px!important;left:0!important;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAABFCAMAAABE4oc2AAAAeFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVyEiIAAAAJ3RSTlMAByQoEAMKZBIN39RsQR8Zp3otFelUm42AX006tTLyxL1YzK6UiJ9zbzQkAAABa0lEQVQoz3WRWZLDIAxExR4bY/AW79kmGd3/hgMiTuVn+sN+pWqpEQAAr+CQeHXee0KOUaVM2DYfg3fpo8lQeqj6gsr77dEwom4wOMyasDJ3U2VDYea1I9J2CkOp81y1QThRcCgCuxLChIhHonD1m6pYHXLtWoC3kjD5Ag3zOC0vNCYFm9nMMTqiOiXlNsQH9pLY0ags1lw5QV1uAS+Saq0QXKgIPKk+Y4j9pL7WwK1KrvMJvlGg3UbDf2RsEzVfG7w4caRU5+bIG4ujqExG3sLcEXXo4P6+nYrm5pN5xW32DojRQ9VZ6WKkPv14rlipPHS5cPg84bExS8rl3Y5mJZK9+217mdPU9kkTQZQ5baG0LFUoR40ck4aUIiYmddyY8Ou8PU5WQ5Z2eBvSf9/b3dUyGbaAv7GNxMLnKeSNsX+P7qfx1Yzjs4hZl+VeLsvCovMGbAOSuCpm35tZ3eL7Rp6Ia2fzQj6db5bwB7VAGypfQp1XAAAAAElFTkSuQmCC) !important;background-position:center bottom!important;background-repeat:no-repeat!important}.yap-R-149298-5 .yap-layout_block_fixed .yap-logo-block__text{font-size:11px!important}.yap-R-149298-5 .yap-layout_block_msn .yap-logo-block__text{font-size:10px!important;color:#666!important}.yap-R-149298-5 .yap-layout_block_row .yap-logo__text{text-decoration:!important}.yap-R-149298-5 .yap-layout_block_row .yap-logo__text:hover{text-decoration:!important}.yap-R-149298-5 .yap-picture-block__link,.yap-R-149298-5 .yap-picture-block__img{display:block!important}.yap-R-149298-5 .yap-title-block{display:inline!important}.yap-R-149298-5 .yap-title-block hl{vertical-align:baseline!important}.yap-R-149298-5 .yap-title-block__text{color:#333333!important;text-decoration:none!important;font-weight:normal!important}.yap-R-149298-5 .yap-title-block__text:hover{color:#666666!important}.yap-R-149298-5 .yap-title-block__text,.yap-R-149298-5 .yap-title-block__favicon{display:inline!important;line-height:1.1!important;vertical-align:baseline!important}#yap-R-149298-5 .yap-title-block__text,#yap-R-149298-5 .yap-title-block__favicon{font-size:130%!important}.yap-R-149298-5 .yap-title-block__favicon{display:inline!important;padding-right:.3em!important;vertical-align:baseline!important}.yap-R-149298-5 .yap-title-block__favicon-img{display:inline-block!important;vertical-align:baseline!important;width:16px!important;height:16px!important}.yap-R-149298-5 .yap-layout_block_single .yap-title-block__favicon-img{vertical-align:bottom!important}.yap-R-149298-5 .yap-title-block__favicon_scale_true .yap-title-block__favicon-img{width:1em!important;height:1em!important;max-width:16px!important;max-height:16px!important;vertical-align:middle!important}.yap-R-149298-5 .yap-layout_block_row .yap-title-block__favicon-img{vertical-align:middle!important}#yap-R-149298-5 .yap-layout_block_fixed .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_fixed .yap-title-block__favicon{font-size:!important}#yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-medium .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-medium .yap-title-block__favicon{font-size:16px!important}#yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__favicon{font-size:13px!important}#yap-R-149298-5 .yap-layout_block_320x50.yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_320x50.yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__favicon,#yap-R-149298-5 .yap-layout_block_adaptive.yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_adaptive.yap-layout_block_fixed.yap-layout_block_fixed-small .yap-title-block__favicon{font-size:12px!important;font-weight:700!important}#yap-R-149298-5 .yap-layout_block_compact .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_compact .yap-title-block__favicon{font-size:100%!important}.yap-R-149298-5 .yap-layout_block_compact .yap-title-block__text{white-space:nowrap!important;font-weight:normal!important}#yap-R-149298-5 .yap-layout_block_msn .yap-title-block__text,#yap-R-149298-5 .yap-layout_block_msn .yap-title-block__favicon{font-size:118%!important;font-weight:700!important}#yap-R-149298-5 .yap-layout_block_mailru .yap-title-block__favicon,#yap-R-149298-5 .yap-layout_block_mailru .yap-title-block__text{font-size:150%!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-title-block__favicon{margin-bottom:-2px!important}#yap-R-149298-5 .yap-layout_block_single .yap-layout__content .yap-title-block__text{font-size:24px!important}#yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single728x90 .yap-layout__content .yap-title-block__text{font-size:28px!important}#yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_medium .yap-layout__content .yap-title-block__text{font-size:20px!important}#yap-R-149298-5 .yap-layout_block_single.yap-layout_block_single_small .yap-layout__content .yap-title-block__text{font-size:18px!important}#yap-R-149298-5 .yap-layout_block_single .yap-layout__content .yap-title-block__favicon{font-size:100%!important}#yap-R-149298-5 .yap-layout_block_0x50 .yap-title-block__text{font-weight:700!important}.yap-R-149298-5 .yap-body-text{display:inline!important;font-weight:400!important;line-height:1.2!important;text-decoration:none!important;color:#333333!important}.yap-R-149298-5 .yap-layout_block_compact .yap-body-text wbr{display:none!important}.yap-R-149298-5 .yap-adtune__button{width:14px!important;height:14px!important}.yap-R-149298-5 .yap-adtune__image{width:8px!important;height:8px!important;margin:3px!important;opacity:.6!important}.yap-R-149298-5 .yap-adtune__image svg{display:block!important}.yap-R-149298-5 .yap-adtune__image polygon{fill:#333333!important}.yap-R-149298-5 .yap-adtune .yap-adtune__text{font:15px/15px Arial,sans-serif!important}.yap-R-149298-5 .yap-layout_block_compact .yap-adtune__text{position:relative!important;top:-2px!important}.yap-R-149298-5 .yap-adtune__tooltip{display:none!important;position:absolute!important;right:18px!important;top:-2px!important;max-width:120px!important;padding:1px 4px 2px!important;font:11px/14.7px Arial,sans-serif!important;color:#fff!important;background:#333!important}.yap-R-149298-5 .yap-adtune__button:hover .yap-adtune__tooltip{display:block!important}.yap-R-149298-5 .yap-adtune_touch_true .yap-adtune__button:hover .yap-adtune__tooltip{display:none!important}.yap-R-149298-5 .yap-layout_block_compact .yap-adtune__tooltip{top:0!important;padding:0 4px 1px!important}.yap-R-149298-5 .yap-adtune__tooltip:before,.yap-R-149298-5 .yap-layout_block_compact .yap-adtune__tooltip:before{position:absolute!important;right:-4px!important;top:50%!important;margin-top:-4px!important;width:8px!important;height:8px!important;background:#333!important;transform:rotate(45deg)!important;transform-origin:center!important;content:""!important;-webkit-transform:rotate(45deg)!important;-moz-transform:rotate(45deg)!important;-ms-transform:rotate(45deg)!important;-o-transform:rotate(45deg)!important;-webkit-transform-origin:center!important;-moz-transform-origin:center!important;-ms-transform-origin:center!important;-o-transform-origin:center!important}.yap-R-149298-5 .yap-adtune_oldie_true .yap-adtune__tooltip:before{overflow:hidden!important;width:5px!important;height:11px!important;margin-top:-7px!important;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAALCAYAAAC3ZUeVAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAABMSURBVBjTYzA2Ni5hQAdAwX9GRkaJ6IL/gfgPEAegC4LwNyC2QRcE4Q9Ao/TQBf8DBY+iC74xNDTUQjHTxMTEGtnMX0ABL4LuxPARAEB/MGK8nMgKAAAAAElFTkSuQmCC") right center no-repeat!important}.yap-R-149298-5 .yap-adtune__tooltip-text{position:relative!important;color:#fff!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__item_abused .yap-layout__adtune{display:none!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__adtune-message{position:absolute!important;z-index:1!important;left:100px!important;right:0!important;top:0!important;height:100%!important;width:!important}.yap-R-149298-5 .yap-layout_block_compact .yap-layout__adtune-message{left:17px!important}.yap-R-149298-5 .yap-adtune-message{position:absolute!important;left:0!important;top:0!important;width:100%!important;height:100%!important;z-index:6!important}.yap-R-149298-5 .yap-adtune-message__table,.yap-R-149298-5 .yap-adtune-message__text{width:100%!important;height:100%!important}.yap-R-149298-5 .yap-adtune-message__text{vertical-align:middle!important;text-align:center!important;font-size:13px!important}.yap-R-149298-5 .yap-contacts__item{display:inline-block!important;vertical-align:baseline!important;padding-right:1em!important;font-size:100%!important;line-height:1.1!important}.yap-R-149298-5 .yap-contacts__item:last-child{padding-right:0!important}.yap-R-149298-5 .yap-layout_hide_contacts .yap-contacts__item{display:none!important}.yap-R-149298-5 .yap-layout_hide_contacts .yap-contacts__item_domain{display:inline-block!important}.yap-R-149298-5 .yap-layout_hide_domain .yap-contacts__item_domain{display:none!important}.yap-R-149298-5 .yap-contacts__phone{white-space:nowrap!important}.yap-R-149298-5 .yap-contacts__item-link,.yap-R-149298-5 .yap-contacts__item-text{display:inline!important;text-decoration:none!important;color:#333333!important}.yap-R-149298-5 .yap-contacts__item-link:hover{text-decoration:none!important;color:#666666!important}.yap-R-149298-5 .yap-contacts__info-icon{display:inline-block!important;padding-right:.4em!important;font:700 italic 100% "Times New Roman",serif!important}.yap-R-149298-5 .yap-layout_block_poster .yap-contacts__domain{display:none!important}.yap-R-149298-5 .yap-layout_block_msn .yap-contacts__item-link,.yap-R-149298-5 .yap-layout_block_msn .yap-contacts__item-text{font-weight:700!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-contacts__item-link,.yap-R-149298-5 .yap-layout_block_mailru .yap-contacts__item-text{font-size:110%!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-contacts__item-link:hover{color:#333333!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-contacts{overflow:hidden!important;text-overflow:ellipsis!important;-webkit-text-overflow:ellipsis!important;-moz-text-overflow:ellipsis!important;-ms-text-overflow:ellipsis!important;-o-text-overflow:ellipsis!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-contacts__item{display:inline!important}.yap-R-149298-5 .yap-address{float:left!important;width:auto!important;max-width:100%!important}.yap-R-149298-5 .yap-address__text{overflow:hidden!important}.yap-R-149298-5 .yap-address__text-wrap{overflow:hidden!important;white-space:nowrap!important;text-overflow:ellipsis!important;color:#333333!important;-webkit-text-overflow:ellipsis!important;-moz-text-overflow:ellipsis!important;-ms-text-overflow:ellipsis!important;-o-text-overflow:ellipsis!important}.yap-R-149298-5 .yap-address__geo{float:right!important;text-align:right!important;padding:0 1px 0 1em!important}.yap-R-149298-5 .yap-layout_type_narrow .yap-address__geo,.yap-R-149298-5 .yap-layout_type_medium .yap-address__geo,.yap-R-149298-5 .yap-layout_type_compatible .yap-address__geo{float:none!important;padding:0!important;text-align:left!important}.yap-R-149298-5 .yap-layout_block_fixed.yap-layout_type_wide .yap-address__geo{padding-right:5px!important}.yap-R-149298-5 .yap-domain{display:inline!important;color:#333333!important}.yap-R-149298-5 .yap-domain:hover{text-decoration:none!important;color:#666666!important}.yap-R-149298-5 .yap-layout_block_compact .yap-domain:hover{text-decoration:none!important}.yap-R-149298-5 .yap-layout_block_0x50 .yap-domain:hover{text-decoration:none!important}.yap-R-149298-5 .yap-layout_block_msn .yap-domain{font-weight:700!important}.yap-R-149298-5 .yap-age{display:inline-block!important;vertical-align:top!important;font-size:70%!important;border:1px solid #dddcda!important;border-radius:4px!important;padding:.1em .2em .05em!important;text-align:center!important;line-height:1.4!important;border-color:#E0E0E0!important;background-color:#FFFFFF!important;-webkit-border-radius:4px!important;-moz-border-radius:4px!important;-ms-border-radius:4px!important;-o-border-radius:4px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-age{border-radius:0!important;padding:0 .2em!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_row .yap-age{line-height:1.4!important}.yap-R-149298-5 .yap-layout_block_320x50 .yap-age,.yap-R-149298-5 .yap-layout_block_320x100 .yap-age,.yap-R-149298-5 .yap-layout_block_msn .yap-age{line-height:1.2!important}.yap-R-149298-5 .yap-layout_block_mailru .yap-age{margin:0!important;padding:0 .2em!important;line-height:1.4!important;font-size:105%!important;border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-warning{overflow:hidden!important;padding:.15em .3em!important;border:1px solid #dddcda!important;font-size:70%!important;line-height:1.1!important;border-radius:4px!important;border-color:#E0E0E0!important;background-color:#FFFFFF!important;-webkit-border-radius:4px!important;-moz-border-radius:4px!important;-ms-border-radius:4px!important;-o-border-radius:4px!important}.yap-R-149298-5 .yap-layout_block_poster .yap-warning{border-radius:0!important;-webkit-border-radius:0!important;-moz-border-radius:0!important;-ms-border-radius:0!important;-o-border-radius:0!important}.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_picture_true .yap-warning{background-color:#FFFFFF!important;border-color:#FFFFFF!important;transition:border-color 200ms 100ms linear,background-color 200ms 100ms linear!important;-webkit-transition:border-color 200ms 100ms linear,background-color 200ms 100ms linear!important;-moz-transition:border-color 200ms 100ms linear,background-color 200ms 100ms linear!important;-ms-transition:border-color 200ms 100ms linear,background-color 200ms 100ms linear!important;-o-transition:border-color 200ms 100ms linear,background-color 200ms 100ms linear!important}.yap-R-149298-5 .yap-layout_block_poster.yap-layout_touch_false .yap-layout__item_picture_true:hover .yap-warning,.yap-R-149298-5 .yap-layout_block_poster .yap-layout__item_picture_true.yap-layout__item_hover .yap-warning{border-color:#E0E0E0!important;background-color:#FFFFFF!important}.yap-R-149298-5 .yap-sitelinks__link{vertical-align:middle!important;display:inline-block!important;margin-right:1em!important;font-weight:400!important;color:#333333!important;text-decoration:none!important}.yap-R-149298-5 .yap-sitelinks__link:hover{color:#666666!important}.yap-R-149298-5 .yap-sitelinks__link:last-child{margin-right:0!important}.yap-R-149298-5 .yap-mobile-app{padding-top:.46em!important;padding-bottom:1px!important}.yap-R-149298-5 .yap-mobile-app_compact{padding-top:.15em!important}.yap-R-149298-5 .yap-mobile-app__button{overflow:hidden!important;display:inline-block!important;vertical-align:top!important;height:2.15em!important;min-width:6.15em!important;margin:-.46em .62em .2em 0!important;padding:0 .77em!important;border:1px solid #333333!important;text-align:center!important;border-radius:4px!important;color:#333333!important;line-height:2.15em!important;cursor:pointer!important;-webkit-border-radius:4px!important;-moz-border-radius:4px!important;-ms-border-radius:4px!important;-o-border-radius:4px!important}.yap-R-149298-5 .yap-mobile-app__button_width_full{display:block!important;margin-right:0!important}.yap-R-149298-5 .yap-mobile-app__button_height_compact{height:1.54em!important;line-height:1.54em!important;margin-top:-.15em!important;margin-bottom:0!important}.yap-R-149298-5 .yap-mobile-app__button_inline{display:inline!important;height:auto!important;line-height:normal!important}.yap-R-149298-5 .yap-mobile-app__button:hover{color:#666666!important;border-color:#666666!important}.yap-R-149298-5 .yap-mobile-app .yap-mobile-app__button-price{display:inline-block!important}.yap-R-149298-5 .yap-layout_hide_price .yap-mobile-app__button-price{display:none!important}.yap-R-149298-5 .yap-mobile-app__rating{display:inline-block!important;vertical-align:top!important;cursor:help!important}.yap-R-149298-5 .yap-mobile-app__rating_width_full{display:block!important;margin-top:1px!important}.yap-R-149298-5 .yap-mobile-app__rating_content_centered{text-align:center!important}.yap-R-149298-5 .yap-layout_hide_rating .yap-mobile-app__rating{display:none!important}.yap-R-149298-5 .yap-mobile-app__rating-votes{display:inline-block!important;vertical-align:middle!important;margin:.2em 0 0 .5em!important;font-size:.8em!important;color:#333333!important;opacity:.8!important}.yap-R-149298-5 .yap-mobile-app__rating .yap-mobile-app__rating-stars{overflow:hidden!important;position:relative!important;display:inline-block!important;vertical-align:middle!important;height:1em!important;width:5em!important;white-space:nowrap!important}.yap-R-149298-5 .yap-mobile-app__rating-stars-scale_filled{position:absolute!important;left:0!important;top:0!important;overflow:hidden!important}.yap-R-149298-5 .yap-mobile-app__rating .yap-mobile-app__rating-star{display:inline-block!important;vertical-align:top!important;fill:#333333!important;opacity:.4!important}.yap-R-149298-5 .yap-mobile-app__rating-stars-scale_filled .yap-mobile-app__rating-star{opacity:1!important;fill:#fc0!important}.yap-R-149298-5 .yap-mobile-app__rating-star .yap-mobile-app__star-svg{display:block!important;height:1em!important;width:1em!important}</style></head>
<body>
   
<div class="post_show">
        

  <div class="post shortcuts_item" id="post_215841">
    <div class="published">14 марта 2014 в 16:22</div>
    <h1 class="title">
      
        <span class="post_title">Часть 2. HID устройство для вращения камеры</span>

      <a href="/sandbox/" class="flag flag_sandbox" title="Перейти в песочницу">из песочницы</a>

    </h1>

    <div class="hubs">
		<a href="http://habrahabr.ru/hub/programming/" class="hub subscribed" title="Вы подписаны на этот хаб">Программирование</a><span class="profiled_hub" title="Профильный хаб">*</span>
</div>


    <div class="content html_format">
      <img src="http://habrastorage.org/getpro/habr/post_images/0c9/ca0/8d1/0c9ca08d1af7d3c37f5e0f58e59c404b.jpg" alt="image"><br>
Это продолжение моей статьи об устройстве для вращения Веб-камеры (предыдущую статью можно найти <a href="http://habrahabr.ru/sandbox/79829/">тут</a>).<br>
<br>
В этой части я расскажу о создании программной части: прошивки для микроконтроллера ATtiny85 и программы для компьютера, для того что бы иметь возможность управлять устройством.<br>
<a name="habracut"></a><br>
Для создания прошивки микроконтроллера и ПО я использовал готовый проект, переработав его под себя.(<a href="http://we.easyelectronics.ru/electro-and-pc/usb-dlya-avr-chast-2-hid-class-na-v-usb.html">Эта</a> информация обязательна к прочтению, так как подробности описывать я не буду).<br>
<br>
<h5>Прошивка микроконтроллера</h5><br>
Прошивка в зависимости от команды программы управления устанавливает ножки 1, 3, 4, 5 в логичную 1 или 0. Также если на протяжении 2 секунд не поступает никакая команда – то все четыре ножки устанавливаются в 0, это сделано для того, что бы при сбое работы программы на ПК устройство не зацикливалось на выполнении последней команды (писал прошивку на AVR Studio4, эта среда не дружит с кириллицей, поэтому проверяйте адреса. Также для тестирования прошивки можно использовать PROTEUS):<br>
<pre><code class="hljs cpp">...
<span class="hljs-keyword">if</span>(bytesRemaining == <span class="hljs-number">0</span>)     <span class="hljs-comment">// Все данные получены</span>
    {                           <span class="hljs-comment">// Выставим значения на PORTB</span>
        <span class="hljs-keyword">if</span> ( pdata.b1 )         <span class="hljs-comment">//Запись состояния ножки 1 из структуры</span>
            PORTB |= _BV(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">else</span>
            PORTB &amp;= ~_BV(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> ( pdata.b2 )         <span class="hljs-comment">//Запись состояния ножки 3 из структуры</span>
            PORTB |= _BV(<span class="hljs-number">3</span>);
        <span class="hljs-keyword">else</span>
            PORTB &amp;= ~_BV(<span class="hljs-number">3</span>);
        <span class="hljs-keyword">if</span> ( pdata.b3 )         <span class="hljs-comment">//Запись состояния ножки 4 из структуры</span>
            PORTB |= _BV(<span class="hljs-number">4</span>);
        <span class="hljs-keyword">else</span>
            PORTB &amp;= ~_BV(<span class="hljs-number">4</span>);

        <span class="hljs-keyword">if</span> ( pdata.b4 )         <span class="hljs-comment">//Запись состояния ножки 5 из структуры</span>
            PORTB |= _BV(<span class="hljs-number">5</span>);
        <span class="hljs-keyword">else</span>
            PORTB &amp;= ~_BV(<span class="hljs-number">5</span>);
    }
...
 <span class="hljs-keyword">if</span>(i==<span class="hljs-number">200</span>)           <span class="hljs-comment">//сброс 1,3,4,5 ножки в 0 через 2сек</span>
	{
	    PORTB &amp;= ~_BV(<span class="hljs-number">1</span>);
	    PORTB &amp;= ~_BV(<span class="hljs-number">3</span>);
	    PORTB &amp;= ~_BV(<span class="hljs-number">4</span>);
	    PORTB &amp;= ~_BV(<span class="hljs-number">5</span>);
	}
...
</code></pre><br>
<h5>Недостача ножки</h5><br>
В Attiny85 всего 8 ножек. Две из них для питания микроконтроллера. Одна для сброса данных, а ещё две задействованы для использования USB интерфейса. Остается три свободных, но мне надо 4 ножки для управления двумя двигателями.<br>
<br>
<img src="http://habrastorage.org/getpro/habr/post_images/ede/8b5/18e/ede8b518eae4bfad7699e60fec30d3b8.jpg" alt="image"><br>
<br>
Выйти с этой ситуации можно двумя способами: первый – сдвиговый регистр (с его помощью можно увеличить количество управляемых выходов до нужного, но при этом придется пожертвовать скоростью и надёжностью. См. <a href="http://avrproject.ru/publ/kak_podkljuchit/bascom_avr_74hc595/2-1-0-44">тут</a>);<br>
Другой – использовать fuse bit, что бы переопределить ножку Reset в обычную вход/выход. (Прочитать можна<a href="http://www.getchip.net/posts/068-kak-pravilno-proshit-avr-fyuzy-fuse-bit/">тут</a>).<br>
Я воспользовался вторым способом и установил в fuses RSTDISBL в 0. (При считывании fuses с помощью SinaProg у меня выскакивала ошибка. Решение которой нашёл <a href="http://forum.easyelectronics.ru/viewtopic.php?t=2975&amp;p=52301">тут</a>).<br>
При прошивке микроконтроллера с такими параметрами fuses, снова перепрошить его можно будет только высоковольтным программатором, поэтому необходимо перепроверять настройку, особенно в usbconfig.h. (Содержаться настройки для V-USB)<br>
При неудачных прошивках необходимо вручную в «диспетчере устройств» удалить драйвер, который устанавливает ОС для вашего устройства. Иначе неправильно установленный драйвер будет использоваться дальше для всех последующих прошивок микроконтроллера.<br>
<br>
<h5>Программа управления</h5><br>
Я использовал готовый код, поэтому проблем с настройкой связи у меня не возникло. Данная часть кода отвечает за формирование и отправку команд, а также за получение информации про состояние устройства (в данном случае за состояние ножек 1 3 4 5. Привожу толька класс):<br>
<br>
<pre><code class="hljs cpp"><span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> Max <span class="hljs-number">230</span></span>

<span class="hljs-keyword">class</span> Device{
   <span class="hljs-keyword">class</span> <span class="hljs-keyword">dataexchange_t</span>		<span class="hljs-comment">// Описание структуры для передачи данных</span>
	{
	<span class="hljs-keyword">public</span>:
	   <span class="hljs-keyword">char</span> b1;        <span class="hljs-comment">// Я решил написать структуру на 4 байта.</span>
	   <span class="hljs-keyword">char</span> b2;        <span class="hljs-comment">// На каждый байт подцепим ногу из PORTB. Конечно это</span>
	   <span class="hljs-keyword">char</span> b3;        <span class="hljs-comment">// не рационально (всего то 4 бита нужно).</span>
	   <span class="hljs-keyword">char</span> b4;
	}data;
   <span class="hljs-keyword">class</span> Position{
	<span class="hljs-keyword">public</span>:
		<span class="hljs-keyword">float</span> x;
		<span class="hljs-keyword">float</span> y;
   }positionTransform, cameraPosition;     <span class="hljs-comment">/* positionTransform - нужно для хранения трансформированных 
                                             градусных значений в мою систему cameraPosition - записуеться 
											 текущее положение камеры в градусах */</span>
   HIDLibrary &lt;<span class="hljs-keyword">dataexchange_t</span>&gt; hid; <span class="hljs-comment">// создаем экземпляр класса с типом нашей структуры</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> processTime;       <span class="hljs-comment">// для уменьшения количества ненужного обращения к устройству</span>
   FILE *f;                         <span class="hljs-comment">// файл для сохранения последнего положения камеры</span>
   <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">SendData</span><span class="hljs-params">(dataexchange_t *)</span></span>;
<span class="hljs-keyword">public</span>:
   <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetCameraPosition</span><span class="hljs-params">(<span class="hljs-keyword">short</span> <span class="hljs-keyword">int</span> *, <span class="hljs-keyword">short</span> <span class="hljs-keyword">int</span> *)</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MoveCamera</span><span class="hljs-params">()</span></span>;
   <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">StopMoveCamera</span><span class="hljs-params">()</span></span>;
   Device()
   {
	   processTime = <span class="hljs-number">10</span>;
	   (<span class="hljs-keyword">int</span>&amp;)data = positionTransform.x = positionTransform.y = <span class="hljs-number">0</span>;
	   f = fopen(<span class="hljs-string">"CameraPosition.txt"</span>,<span class="hljs-string">"r+"</span>);
	   <span class="hljs-built_in">fscanf</span>(f,<span class="hljs-string">"%f %f"</span>, &amp;cameraPosition.x, &amp;cameraPosition.y);
	   <span class="hljs-keyword">if</span>(cameraPosition.x &lt; -Max || cameraPosition.y &lt; -Max || cameraPosition.y &gt; Max || cameraPosition.x &gt; Max)
		   cameraPosition.x = cameraPosition.y = <span class="hljs-number">0</span>;
   }
   ~Device()
   {   
	   fclose(f);
   }
};
...
</code></pre><br>
<br>
Так как я отказался от вращения камеры на 360 градусов, пришлось програмно ввести ограничение на 230 градусов, то есть камера вращается влево (230 градусов) и вправо (-230 градусов) на 230 градусов относительно начала. (Стоит отметить, что программное ограничение это худшее решение такой проблемы, лучше было бы установить механические выключатели, которые выключали бы одну из цепей питания двигателя).<br>
<br>
Также я ввёл специфичную координатную ось для управления поворотом камеры, чтобы не нагружать ОС постоянной отправкой команд. Пользователь водит на сколько градусов надо повернуть камеру относительно текущего положения. Далее введённые градусы преобразуются в несколько команд, которые с интервалом в 2 секунды должны будут отправлены на устройство.<br>
<pre><code class="hljs cpp">...
  <span class="hljs-comment">// Трансформация градусной координаты в мою по горизонтали(камера вращается после команды 2сек)</span>
	<span class="hljs-keyword">if</span>(*x &gt; <span class="hljs-number">0</span>)
		positionTransform.x = (*x * <span class="hljs-number">0.20832</span>); <span class="hljs-comment">// разная скорость вращения по часовой стрелке и против</span>
	<span class="hljs-keyword">else</span> positionTransform.x = (*x * <span class="hljs-number">0.225</span>);  
	<span class="hljs-comment">// Трансформация градусной координаты в мою по вертикали(камера вращается после команды 2сек)</span>
	<span class="hljs-keyword">if</span>(*y &gt; <span class="hljs-number">0</span>)
		positionTransform.y = (*y * <span class="hljs-number">0.20832</span>); 
	<span class="hljs-keyword">else</span> positionTransform.y = (*y * <span class="hljs-number">0.225</span>);  
...
</code></pre><br>
<br>
Устройство сначала поворачивает камеру по горизонтали, а потом по вертикали, чтобы не перегружать USB порт одновременным питанием двух двигателей.<br>
<br>
В результате получилось, что микроконтроллер управляется программой с компьютера, который в свою очередь управляет драйвером двигателя (Я использовал L293), а он уже управляет двумя двигателями.<br>
<br>
<h5>Передача видео- и аудио-сигнала</h5><br>
 Мне не обходимо было передать сигнал с камеры и управлять ей на расстоянии. Выход я нашёл в использовании API Skype (Проблема была только в том, что API Skype больше не поддерживается, поэтому есть баги). Для использования API Skype необходимо на диск, где установлена ОС скопировать файл Skype4COM.dll.<br>
<br>
Моя программа для Skype мониторит чат с клиентом – пользователем, который использует моё устройство. При введении пользователем в чате команды старта работы камеры (В данном случае команда «0000») программа сделает видео-звонок и включит устройство. После этого пользователь может управлять камерой путём введения следующих команд в чат:<br>
<br>
«StopMove MoveTo('X'@'Y') VideoOn VideoOff Wait'TimeInSec'». (На команду VideoOff скайп сначала выключит камеру, а потом сразу включает, если в ручном режиме сначала включить видео показ, то эта команда работает нормально):<br>
<br>
<pre><code class="hljs zephir">...
<span class="hljs-keyword">char</span> comandName[] = {<span class="hljs-string">"###"</span>};  <span class="hljs-comment">// Логин клиента </span>
  <span class="hljs-keyword">char</span> comandStart[] = {<span class="hljs-string">"0000"</span>};           <span class="hljs-comment">// Команда старта </span>
  <span class="hljs-keyword">int</span> timeWait = <span class="hljs-number">500</span>;                      <span class="hljs-comment">// Максимальное время бездействия клиента</span>
  
	 <span class="hljs-comment">// Инициализмруем COM соединение </span>
 CoInitialize(<span class="hljs-keyword">NULL</span>); 
 
  <span class="hljs-comment">// Создаем Skype объект </span>
  SKYPE4COMLib::ISkypePtr pSkype(__uuidof(SKYPE4COMLib::Skype)); 
 
  <span class="hljs-comment">// Соединяемся с Skype API </span>
  pSkype-&gt;Attach(<span class="hljs-number">6</span>,VARIANT_TRUE); 

  _bstr_t comand;
  IChatMessagePtr curMessage, privMessage = <span class="hljs-keyword">NULL</span>;
  COleDateTime startTime(time(<span class="hljs-keyword">NULL</span>));
  
  <span class="hljs-keyword">for</span>(;;)<span class="hljs-comment">// нужно еще условие выхода допилить</span>
  {
	  curMessage = pSkype-&gt;GetMessages((_bstr_t)comandName)-&gt;GetItem(<span class="hljs-number">1</span>); <span class="hljs-comment">// Получаем последние сообщение от клиента</span>
	  comand = curMessage-&gt;GetBody();  <span class="hljs-comment">// Получаем текст сообщения</span>
	  <span class="hljs-keyword">if</span>(!strcmp((<span class="hljs-keyword">char</span>*)comand,comandStart) &amp;&amp; (privMessage == <span class="hljs-keyword">NULL</span> || 
		  privMessage-&gt;GetId() != curMessage-&gt;GetId()) &amp;&amp; (startTime.m_dt &lt; curMessage-&gt;GetTimestamp()))
		{
			privMessage = curMessage;
			curMessage-&gt;PutSeen(<span class="hljs-keyword">true</span>); <span class="hljs-comment">// Отмечаем полученное сообщение как прочитанное</span>
			ControlDevice(pSkype, comandName, timeWait, privMessage);		
		}
		<span class="hljs-keyword">else</span> Sleep(<span class="hljs-number">5000</span>);
  }
...
_bstr_t comand;
  IChatMessagePtr curMessage;
  <span class="hljs-keyword">int</span> timeToSendMessage = (timeWait/<span class="hljs-number">100</span>)*<span class="hljs-number">80</span>;
  Device device;
  ICallPtr call;
  <span class="hljs-comment">// Проверка (Если звоним клиенту, то положить трубку)</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = pSkype-&gt;GetActiveCalls()-&gt;GetCount(); i != <span class="hljs-number">0</span> ; i--)
  {
	  call = pSkype-&gt;GetActiveCalls()-&gt;GetItem(i); <span class="hljs-comment">// Получить текущие звонки</span>
	  <span class="hljs-keyword">if</span>(!strcmp((<span class="hljs-keyword">char</span>*)(call-&gt;GetPartnerHandle()),comandName))
	  {
		  call-&gt;Finish(); <span class="hljs-comment">// Положить трубку</span>
		  Sleep(<span class="hljs-number">2000</span>);
		  <span class="hljs-keyword">break</span>;
	  }
  }
  call = pSkype-&gt;PlaceCall(_bstr_t(comandName), L<span class="hljs-string">""</span>, L<span class="hljs-string">""</span>, L<span class="hljs-string">""</span>);  <span class="hljs-comment">// Звоним клиенту</span>
  pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"З'єднання розпочате"</span>)); 
  <span class="hljs-keyword">if</span>(!device.Connect())                                                 <span class="hljs-comment">// Подключаемся к устройству</span>
    pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"Пристрій управління не підключен"</span>));	
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i &lt; timeWait &amp;&amp; call-&gt;Status != clsInProgress;i++)       <span class="hljs-comment">// Ожидания поднятия трубки клиентом</span>
	  Sleep(<span class="hljs-number">20</span>);
  <span class="hljs-keyword">if</span>(call-&gt;Status == clsInProgress)
  {
    Sleep(<span class="hljs-number">2000</span>);
	call-&gt;StartVideoSend();  <span class="hljs-comment">// Включить видео(иногда не работает)</span>
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> time = <span class="hljs-number">0</span>; call-&gt;Status == clsInProgress;time++)
	{
		<span class="hljs-keyword">if</span>(time &gt;= timeWait)  <span class="hljs-comment">// Если время ожидания кончилось - положить трубку</span>
		{
			call-&gt;Finish();
			<span class="hljs-keyword">break</span>;
		}
		curMessage = pSkype-&gt;GetMessages((_bstr_t)comandName)-&gt;GetItem(<span class="hljs-number">1</span>);
		<span class="hljs-keyword">if</span>(curMessage-&gt;GetId() != privMessage-&gt;GetId()) <span class="hljs-comment">// Ловим сообщения в чате</span>
		{
		  privMessage = curMessage;
		  <span class="hljs-keyword">if</span>(time &gt; <span class="hljs-number">0</span>)
	        time = <span class="hljs-number">0</span>;
		  <span class="hljs-keyword">if</span>(!ComandToDevice((<span class="hljs-keyword">char</span>*)curMessage-&gt;GetBody(),&amp;device,pSkype,comandName,&amp;time,call))<span class="hljs-comment">// Отправка сообщения для обработки</span>
			  pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"Команда не виконана"</span>)); 
		  curMessage-&gt;PutSeen(<span class="hljs-keyword">true</span>);
		}
		Sleep(<span class="hljs-number">200</span>);
		<span class="hljs-keyword">if</span>(!device.MoveCamera())
		{
			pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"Проблеми з пристроєм управління"</span>));	
			device.StopMoveCamera();
		}
		<span class="hljs-keyword">if</span>(timeToSendMessage == time)
			pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"Час очікування команди спливає"</span>)); 
	}
  }
  
  pSkype-&gt;SendMessage(_bstr_t(comandName), _bstr_t(L<span class="hljs-string">"З'єднання завершено"</span>)); 
}
...
</code></pre><br>
Видео демонстрации работы устройства.<br>
<br>
<iframe width="560" height="349" src="//www.youtube.com/embed/e8YDh1pZeuA?wmode=opaque" frameborder="0" allowfullscreen=""></iframe><br>
<br>
Полностью весь проект можна взять <a href="http://webfile.ru/file/b75212ba1ae191477d1ba822d27abcfb">тут</a>.
      <div class="clear"></div>
    </div>

    
<ul class="tags">
	<li><a href="http://habrahabr.ru/search/?q=%5B%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80%20ATtiny85%5D&amp;target_type=posts" rel="tag">микроконтроллер ATtiny85</a></li><li>, <a href="http://habrahabr.ru/search/?q=%5B%D0%B4%D1%80%D0%B0%D0%B9%D0%B2%D0%B5%D1%80%20%D0%B4%D0%B2%D0%B8%D0%B3%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9%20l293d%5D&amp;target_type=posts" rel="tag">драйвер двигателей l293d</a></li><li>, <a href="http://habrahabr.ru/search/?q=%5BV-USB%5D&amp;target_type=posts" rel="tag">V-USB</a></li><li>, <a href="http://habrahabr.ru/search/?q=%5BSkype%20API%5D&amp;target_type=posts" rel="tag">Skype API</a></li>
</ul>

      <div class="infopanel_wrapper">
    <ul class="postinfo-panel postinfo-panel_post" id="infopanel_post_215841">
      <!-- Виджет голосования за пост -->
          <li class="postinfo-panel__item">
            <div class="voting-wjt js-voting  ">
                <button type="button" disabled="" class="voting-wjt__button voting-wjt__button_plus js-plus" title="За свои публикации голосовать нельзя. Срок голосования истек.">
                  <span>↑</span>
                </button>

              <div class="voting-wjt__counter voting-wjt__counter_positive  js-mark">
                  <span class="voting-wjt__counter-score js-score" title="Общий рейтинг 33: ↑27 и ↓6">+21</span>
              </div>

                <button type="button" disabled="" class="voting-wjt__button voting-wjt__button_minus js-minus" title="За свои публикации голосовать нельзя.Срок голосования истек.">
                  <span>↓</span>
                </button>

            </div>
          </li>

      <!-- Количество просмотров публикации -->

      <li class="postinfo-panel__item">
        <div class="views-count_post" title="Просмотры публикации">13135</div>
      </li>

      <!-- Кнопка «Добавить в избранное» -->
      <li class="postinfo-panel__item">
        <div class="favorite-wjt favorite">
            <button type="button" class="favorite-wjt__button add" title="Добавить в избранное" onclick="return posts_add_to_favorite(this, '2', 215841);">
              <span>В избранное</span>
            </button>
          <span class="favorite-wjt__counter js-favs_count" title="Количество пользователей, добавивших публикацию в избранное">108</span>
        </div>
      </li>




      <!-- шеринг в соцсети -->
        <li class="postinfo-panel__item postinfo-panel__item_socials  postinfo-panel__item_socials_right ">
          <ul class="post-share">
            <li class="post-share__item">
              <a href="http://twitter.com/intent/tweet?text=%D0%A7%D0%B0%D1%81%D1%82%D1%8C+2.+HID+%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE+%D0%B4%D0%BB%D1%8F+%D0%B2%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D1%8F+%D0%BA%D0%B0%D0%BC%D0%B5%D1%80%D1%8B+http://habr.ru/p/215841/+via+%40habrahabr+%23habr" class="post-share__item-link twitter" title="Опубликовать ссылку в Twitter" target="_blank"></a>
            </li>
            <li class="post-share__item">
              <a href="https://vk.com/share.php?url=http://habrahabr.ru/post/215841/" class="post-share__item-link vkontakte" title="Опубликовать ссылку во ВКонтакте" onclick="window.open(this.href, 'Опубликовать ссылку во Вконтакте', 'width=800,height=300'); return false"></a>
            </li>
            <li class="post-share__item">
              <a href="https://www.facebook.com/sharer/sharer.php?u=http://habrahabr.ru/post/215841/" class="post-share__item-link facebook" title="Опубликовать ссылку в Facebook" onclick="window.open(this.href, 'Опубликовать ссылку в Facebook', 'width=640,height=436,toolbar=0,status=0'); return false"></a>
            </li>
            <li class="post-share__item">
              <a href="https://getpocket.com/edit?url=http://habrahabr.ru/post/215841/" target="_blank" class="post-share__item-link pocket" title="Добавить ссылку в Pocket"></a>
            </li>
          </ul>
        </li>

      <!-- кнопка пожаловаться -->
    </ul>
  </div>

        

  <div class="author-info author-info_top">
    <a href="/users/Kotovoin" class="author-info__image">
      <img src="http://habrahabr.ru/i/avatars/stub-user-middle.gif" class="author-info__image-pic">
    </a>

    <div class="author-info__desc">
      <div class="author-info__username">
        <a href="/users/Kotovoin" class="author-info__nickname">@Kotovoin</a>

        <div class="karma__widjet voting-wjt voting-wjt_small js-karma" title="Карма пользователя">


          <div class="voting-wjt__counter voting-wjt__counter_positive">
            <span class="voting-wjt__label">карма</span>
            <span class="voting-wjt__counter-score js-karma_num">11,0</span>
          </div>

        </div>

        <div class="user-rating" title="Рейтинг пользователя">
          <span class="user-rating__label">рейтинг</span>
          <span class="user-rating__value">0,0</span>
        </div>
      </div>

          <div class="author-info__specialization">
            <a href="https://habrahabr.ru/auth/settings/profile/#user_specializm" class="author-info__link_dotted"> Написать о себе</a>
            <span class="author-info__info_helper">(Например: Программист)</span>
          </div>

          <div class="author-info__contacts">
            <a href="https://habrahabr.ru/auth/settings/profile/#user_contacts" class="author-info__link_dotted"> Ваши ссылки</a>
            <span class="author-info__info_helper">(Личный сайт, Фейсбук, Твиттер и др.)</span>
          </div>
    </div>
  </div>

  </div>
</div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Test2 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:336px;height:280px"
     data-ad-client="ca-pub-7530468547300238"
     data-ad-slot="8159703704"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>Responsive</h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7530468547300238"
     data-ad-slot="1823635307"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>Leaderboard</h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Leaderboard -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-7530468547300238"
     data-ad-slot="1684034501"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>Large Mobile Banner</h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Large Mobile Banner -->
<ins class="adsbygoogle"
     style="display:inline-block;width:320px;height:100px"
     data-ad-client="ca-pub-7530468547300238"
     data-ad-slot="9067700504"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</body>
</html>
